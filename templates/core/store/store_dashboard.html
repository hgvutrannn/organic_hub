{% extends 'core/base.html' %}

{% block title %}Dashboard - {{ store.store_name }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center">
                <div class="bg-primary bg-opacity-10 rounded-circle p-3 me-3">
                    <i class="fas fa-tachometer-alt text-primary fs-1"></i>
                </div>
                <div>
                    <h1 class="display-6 fw-bold mb-1">Dashboard - {{ store.store_name }}</h1>
                    <p class="text-muted mb-0">Quản lý cửa hàng của bạn</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Status Banner -->
    {% if latest_request %}
        {% if latest_request.status == 'pending' %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-warning border-0 shadow-sm rounded-4" role="alert">
                    <div class="d-flex align-items-center">
                        <div class="bg-warning bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="fas fa-clock text-warning fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="alert-heading fw-bold mb-2">Yêu cầu xác minh đang được xem xét</h5>
                            <p class="mb-2">Yêu cầu xác minh #{{ latest_request.request_id }} của bạn đang được admin xem xét. Vui lòng chờ thông báo.</p>
                            <a href="{% url 'verification_status' store.store_id %}" class="btn btn-outline-warning btn-sm rounded-pill">
                                <i class="fas fa-eye me-1"></i>Xem trạng thái chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% elif latest_request.status == 'rejected' %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-danger border-0 shadow-sm rounded-4" role="alert">
                    <div class="d-flex align-items-center">
                        <div class="bg-danger bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="fas fa-exclamation-triangle text-danger fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="alert-heading fw-bold mb-2">Yêu cầu xác minh bị từ chối</h5>
                            <p class="mb-2">Yêu cầu xác minh #{{ latest_request.request_id }} của bạn đã bị từ chối. Vui lòng kiểm tra ghi chú của admin và gửi yêu cầu mới.</p>
                            {% if latest_request.admin_notes %}
                            <div class="mb-3">
                                <strong>Ghi chú từ admin:</strong>
                                <p class="mb-2 text-muted">{{ latest_request.admin_notes }}</p>
                            </div>
                            {% endif %}
                            <a href="{% url 'verification_management' store.store_id %}" class="btn btn-outline-danger btn-sm rounded-pill me-2">
                                <i class="fas fa-plus me-1"></i>Gửi yêu cầu mới
                            </a>
                            <a href="{% url 'verification_status' store.store_id %}" class="btn btn-outline-secondary btn-sm rounded-pill">
                                <i class="fas fa-eye me-1"></i>Xem trạng thái chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% elif latest_request.status == 'approved' %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-success border-0 shadow-sm rounded-4" role="alert">
                    <div class="d-flex align-items-center">
                        <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="fas fa-check-circle text-success fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="alert-heading fw-bold mb-2">Yêu cầu xác minh đã được phê duyệt</h5>
                            <p class="mb-0">Chúc mừng! Yêu cầu xác minh #{{ latest_request.request_id }} của bạn đã được phê duyệt và cửa hàng có thể bắt đầu bán hàng.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    {% else %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-info border-0 shadow-sm rounded-4" role="alert">
                    <div class="d-flex align-items-center">
                        <div class="bg-info bg-opacity-10 rounded-circle p-3 me-3">
                            <i class="fas fa-info-circle text-info fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="alert-heading fw-bold mb-2">Chưa có yêu cầu xác minh</h5>
                            <p class="mb-0">Bạn chưa gửi yêu cầu xác minh nào. Hãy tải lên các giấy tờ chứng nhận để bắt đầu quá trình xác minh cửa hàng.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Store Info -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-header bg-gradient bg-opacity-10 border-0">
                    <h3 class="mb-0 fw-bold">
                        <i class="fas fa-info-circle me-2"></i>Thông tin cửa hàng
                    </h3>
                </div>
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-1">Tên cửa hàng</h6>
                                <p class="mb-0 fs-5">{{ store.store_name }}</p>
                            </div>
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-1">Mô tả</h6>
                                <p class="mb-0">{{ store.store_description|default:"Chưa có mô tả" }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-1">Trạng thái xác minh</h6>
                                <span class="badge {% if store.is_verified_status == 'verified' %}bg-success{% elif store.is_verified_status == 'rejected' %}bg-danger{% else %}bg-warning{% endif %} fs-6">
                                    {{ store.get_is_verified_status_display }}
                                </span>
                            </div>
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-1">Ngày tạo</h6>
                                <p class="mb-0">{{ store.created_at|date:"d/m/Y H:i" }}</p>
                            </div>
                            {% if store.verified_at %}
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-1">Ngày xác minh</h6>
                                <p class="mb-0">{{ store.verified_at|date:"d/m/Y H:i" }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-header bg-gradient bg-opacity-10 border-0">
                    <h3 class="mb-0 fw-bold">
                        <i class="fas fa-bolt me-2"></i>Thao tác nhanh
                    </h3>
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        <div class="col-md-6 col-lg-4">
                            <a href="{% url 'store_products' store.store_id %}" 
                               class="btn btn-outline-primary btn-lg w-100 rounded-pill">
                                <i class="fas fa-box me-2"></i>Quản lý sản phẩm
                            </a>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <a href="{% url 'verification_management' store.store_id %}" 
                               class="btn btn-outline-warning btn-lg w-100 rounded-pill">
                                <i class="fas fa-certificate me-2"></i>Quản lý xác minh
                            </a>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <a href="{% url 'store_orders' store.store_id %}" 
                               class="btn btn-outline-success btn-lg w-100 rounded-pill">
                                <i class="fas fa-shopping-cart me-2"></i>Xem đơn hàng
                            </a>
                        </div>
                        {% if store.is_verified_status == 'verified' %}
                        <div class="col-md-6 col-lg-4">
                            <a href="{% url 'add_product' store.store_id %}" 
                               class="btn btn-outline-info btn-lg w-100 rounded-pill">
                                <i class="fas fa-plus me-2"></i>Thêm sản phẩm
                            </a>
                        </div>
                        {% else %}
                        <div class="col-md-6 col-lg-4">
                            <button class="btn btn-outline-secondary btn-lg w-100 rounded-pill" disabled>
                                <i class="fas fa-lock me-2"></i>Thêm sản phẩm
                            </button>
                            <small class="text-muted d-block mt-1">Cần xác minh cửa hàng</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
