{% extends 'core/store/store_base.html' %}
{% load static %}

{% block store_title %}{% if discount_code %}Edit{% else %}Create{% endif %} Discount Code{% endblock %}

{% block store_page_title %}{% if discount_code %}Edit Discount Code{% else %}Create Discount Code{% endif %}{% endblock %}
{% block store_page_subtitle %}{% if discount_code %}Edit discount code{% else %}Create new discount code{% endif %}{% endblock %}

{% block store_content %}
<form method="post" id="discountCodeForm">
    {% csrf_token %}
    
    <!-- Action Buttons at Top -->
    <div class="d-flex justify-content-between mb-4">
        <a href="{% url 'store_discount_code_list' store.store_id %}" class="btn btn-outline-secondary rounded-pill">
            <i class="fas fa-arrow-left me-2"></i>Back
        </a>
        <button type="submit" class="btn btn-primary rounded-pill">
            <i class="fas fa-save me-2"></i>Save
        </button>
    </div>
    
    <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-header bg-white border-0">
            <h5 class="mb-0 fw-bold">Discount Code Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Discount Code <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="code" 
                           value="{% if discount_code %}{{ discount_code.code }}{% endif %}" 
                           {% if discount_code %}readonly{% endif %}
                           required maxlength="50" style="text-transform: uppercase;">
                    <small class="text-muted">Code will be automatically converted to uppercase</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Discount Code Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="name" 
                           value="{% if discount_code %}{{ discount_code.name }}{% endif %}" 
                           required>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label fw-bold">Description</label>
                <textarea class="form-control" name="description" rows="2">{% if discount_code %}{{ discount_code.description }}{% endif %}</textarea>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Discount Type <span class="text-danger">*</span></label>
                    <select class="form-select" name="discount_type" id="discountType" required>
                        <option value="percentage" {% if discount_code and discount_code.discount_type == 'percentage' %}selected{% endif %}>Percentage (%)</option>
                        <option value="fixed" {% if discount_code and discount_code.discount_type == 'fixed' %}selected{% endif %}>Fixed Amount (VNĐ)</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Discount Value <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <input type="number" class="form-control" name="discount_value" 
                               value="{% if discount_code %}{{ discount_code.discount_value|floatformat:0 }}{% endif %}" 
                               required min="0" step="{% if discount_code and discount_code.discount_type == 'percentage' %}0.01{% else %}1{% endif %}">
                        <span class="input-group-text" id="discountUnit">{% if discount_code and discount_code.discount_type == 'percentage' %}%{% else %}VNĐ{% endif %}</span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3" id="maxDiscountContainer" {% if not discount_code or discount_code.discount_type != 'percentage' %}style="display: none;"{% endif %}>
                    <label class="form-label fw-bold">Maximum Discount</label>
                    <input type="number" class="form-control" name="max_discount_amount" 
                           value="{% if discount_code %}{{ discount_code.max_discount_amount|default:''|floatformat:0 }}{% endif %}" 
                           min="0" step="1000">
                    <small class="text-muted">Only applies when discount type is percentage</small>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Maximum Usage</label>
                    <input type="number" class="form-control" name="max_usage" 
                           value="{% if discount_code %}{{ discount_code.max_usage }}{% else %}0{% endif %}" 
                           min="0">
                    <small class="text-muted">0 = unlimited</small>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Status</label>
                    <select class="form-select" name="status" id="statusSelect">
                        <option value="draft" {% if discount_code and discount_code.status == 'draft' %}selected{% endif %}>Draft</option>
                        <option value="active" {% if discount_code and discount_code.status == 'active' %}selected{% endif %}>Active</option>
                        <option value="inactive" {% if discount_code and discount_code.status == 'inactive' %}selected{% endif %}>Inactive</option>
                    </select>
                </div>
            </div>
            
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Start Date <span class="text-danger">*</span></label>
                    <input type="datetime-local" class="form-control" name="start_date" 
                           value="{% if discount_code %}{{ discount_code.start_date|date:'Y-m-d\TH:i' }}{% endif %}" 
                           required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">End Date <span class="text-danger">*</span></label>
                    <input type="datetime-local" class="form-control" name="end_date" 
                           value="{% if discount_code %}{{ discount_code.end_date|date:'Y-m-d\TH:i' }}{% endif %}" 
                           required>
                </div>
            </div>
        </div>
    </div>
</form>

{% endblock %}

{% block extra_js %}
<script>
    // Update discount unit display based on discount type
    document.getElementById('discountType').addEventListener('change', function() {
        const unit = this.value === 'percentage' ? '%' : 'VNĐ';
        document.getElementById('discountUnit').textContent = unit;
        
        // Update step attribute for discount value input
        const discountValueInput = document.querySelector('input[name="discount_value"]');
        if (this.value === 'percentage') {
            discountValueInput.step = '0.01';
        } else {
            discountValueInput.step = '1';
        }
        
        // Show/hide max discount field
        const maxDiscountContainer = document.getElementById('maxDiscountContainer');
        if (this.value === 'percentage') {
            maxDiscountContainer.style.display = 'block';
        } else {
            maxDiscountContainer.style.display = 'none';
    }
    });
</script>
{% endblock %}

